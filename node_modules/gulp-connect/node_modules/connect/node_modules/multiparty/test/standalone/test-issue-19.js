var assert = require('assert');
var http = require('http');
var net = require('net');
var multiparty = require('../../');

var client;
var server = http.createServer(function (req, res) {
  var form = new multiparty.Form({maxFields: 1});
  form.on('aborted', function () {
    throw new Error("did not expect aborted");
  });
  var first = true;
  form.on('error', function (err) {
    assert.ok(first);
    first = false;
    client.end();
    assert.ok(/maxFields/.test(err.message));
    server.close();
  });